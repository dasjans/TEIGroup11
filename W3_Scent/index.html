<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scent Heads Up ‚Äì Tabletop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Optional fun font -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --table-green: #14532d;
      --table-dark: #052e16;
      --card-bg: #fffaf3;
      --card-edge: #f97316;
      --card-edge-soft: #fed7aa;
      --accent-pink: #fb7185;
      --accent-blue: #38bdf8;
      --accent-gold: #fbbf24;
      --text-main: #111827;
      --text-muted: #6b7280;
      --danger: #f97373;
      --success: #4ade80;
      --shadow-card: 0 14px 30px rgba(0,0,0,0.35);
      --radius-card: 22px;
    }

    * {
      box-sizing: border-box;
      font-family: "Baloo 2", system-ui, -apple-system, BlinkMacSystemFont,
                   "SF Pro Text", "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background:
        radial-gradient(circle at top, rgba(15,118,110,0.45), transparent 55%),
        radial-gradient(circle at bottom, rgba(22,101,52,0.75), transparent 60%),
        radial-gradient(circle at center, #166534 0, #052e16 60%, #02140b 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .table {
      width: min(1100px, 100vw - 24px);
      height: min(720px, 100vh - 24px);
      background:
        radial-gradient(circle at 20% 10%, rgba(248,250,252,0.08), transparent 55%),
        radial-gradient(circle at 80% 90%, rgba(15,23,42,0.25), transparent 55%),
        repeating-linear-gradient(
          135deg,
          rgba(15,118,110,0.4),
          rgba(15,118,110,0.4) 6px,
          rgba(12,148,136,0.6) 6px,
          rgba(12,148,136,0.6) 12px
        );
      border-radius: 32px;
      box-shadow:
        0 30px 80px rgba(0,0,0,0.6),
        inset 0 0 0 6px rgba(15,23,42,0.65);
      border: 10px solid #3f2305;
      position: relative;
      padding: 18px 18px 22px;
      overflow: hidden;
    }

    .score-card {
      position: absolute;
      top: 14px;
      right: 18px;
      background: radial-gradient(circle at top, #fef3c7, #fffbeb);
      border-radius: 999px;
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.45);
      border: 3px solid #b45309;
      transform: rotate(1.5deg);
      z-index: 2;
    }

    .score-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #ffffff;
      border: 2px solid rgba(15,23,42,0.15);
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .score-chip span.value {
      font-weight: 700;
      color: var(--text-main);
    }

    .score-chip.correct {
      border-color: rgba(34,197,94,0.8);
      color: #166534;
      background: #dcfce7;
    }

    .table-title {
      position: absolute;
      top: 18px;
      left: 24px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      color: #fefce8;
      text-shadow: 0 3px 8px rgba(0,0,0,0.7);
      z-index: 2;
    }

    .table-title-icon {
      font-size: 1.6rem;
      background: radial-gradient(circle at top, #fb7185, #f97316);
      border-radius: 999px;
      padding: 6px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      border: 2px solid rgba(254,249,195,0.8);
    }

    .table-title-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .table-title-text .main {
      font-size: 1.2rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-weight: 700;
    }

    .table-title-text .sub {
      font-size: 0.78rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      opacity: 0.9;
    }

    .table-inner {
      position: absolute;
      inset: 70px 20px 18px 20px;
      display: grid;
      grid-template-columns: 1.4fr 0.9fr;
      gap: 14px;
      align-items: center;
      justify-items: center;
    }

    @media (max-width: 900px) or (max-height: 650px) {
      .table {
        height: auto;
        min-height: 640px;
      }
      .table-inner {
        position: static;
        margin-top: 68px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 4px solid var(--card-edge);
      box-shadow: var(--shadow-card);
      padding: 14px 16px 18px;
      max-width: 100%;
    }

    .card-main {
      width: 100%;
      max-width: 640px;
      transform: rotate(-2.2deg);
      border-color: var(--card-edge-soft);
      background:
        radial-gradient(circle at top left, #fef3c7, transparent 55%),
        var(--card-bg);
      position: relative;
    }

    .card-side {
      width: 100%;
      max-width: 360px;
      transform: rotate(3deg);
      background:
        radial-gradient(circle at bottom right, #e0f2fe, transparent 55%),
        var(--card-bg);
      border-color: #38bdf8;
      transition: height 0.2s ease, padding 0.2s ease;
    }

    .card-header-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .card-main h2 {
      margin: 0 0 4px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-main h2 span.emoji {
      font-size: 1.2rem;
    }

    /* Player round mini-card */
    .player-round-card {
      margin-bottom: 8px;
      padding: 6px 10px;
      border-radius: 14px;
      background: #ecfdf5;
      border: 2px solid #34d399;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      font-size: 0.9rem;
    }

    .player-round-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #047857;
    }

    .player-round-names {
      font-weight: 700;
      color: #065f46;
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .player-round-names span {
      white-space: nowrap;
    }

    .categories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 4px 0 6px;
    }

    .category-btn {
      flex: 1 1 31%;
      min-width: 145px;
      border-radius: 18px;
      padding: 8px 10px;
      background: #fefce8;
      border: 2px solid #facc15;
      color: var(--text-main);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: all 0.15s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .category-btn span.label {
      text-align: left;
      font-weight: 600;
    }

    .category-btn span.pill {
      font-size: 0.7rem;
      padding: 3px 7px;
      border-radius: 999px;
      background: #fee2e2;
      color: #b91c1c;
    }

    .category-btn:hover {
      transform: translateY(-1px) rotate(-0.8deg);
      box-shadow: 0 7px 16px rgba(0,0,0,0.18);
      background: #fffbeb;
    }

    .category-btn.active {
      background: #ffedd5;
      border-color: #f97316;
      box-shadow: 0 0 0 3px rgba(248,171,94,0.7);
    }

    .status-line {
      margin-top: 4px;
      font-size: 0.85rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: #d4d4d8;
    }

    .dot.live {
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34,197,94,0.3);
    }

    .round-info {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 16px;
      background: #fffbeb;
      border: 2px dashed #f59e0b;
      font-size: 0.88rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .round-info strong {
      color: #b45309;
    }

    .jar-row {
      display: flex;
      gap: 8px;
      margin-top: 2px;
      flex-wrap: wrap;
    }

    .jar-pill {
      padding: 5px 9px;
      border-radius: 999px;
      background: #ffffff;
      border: 2px solid #fecaca;
      font-size: 0.88rem;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 3px 7px rgba(0,0,0,0.07);
    }

    .jar-pill span.label {
      color: var(--text-muted);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .jar-pill span.value {
      font-weight: 700;
      color: var(--text-main);
    }

    .hint {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .timer-block {
      margin-top: 10px;
      padding: 10px 10px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, #dbeafe, #e0f2fe);
      border: 2px solid #1d4ed8;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .timer-display {
      font-variant-numeric: tabular-nums;
      font-size: 1.9rem;
      font-weight: 700;
      color: #1d4ed8;
      text-shadow: 0 1px 0 #bfdbfe;
    }

    .timer-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #2563eb;
    }

    .timer-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    button {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 7px 12px;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all 0.15s ease;
      background: #e5e7eb;
      color: var(--text-main);
      font-weight: 500;
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-gold));
      color: #111827;
      font-weight: 700;
      box-shadow: 0 5px 12px rgba(0,0,0,0.35);
      border: 2px solid rgba(248,250,252,0.7);
    }

    button.secondary {
      background: #ffffff;
      border: 2px solid rgba(148,163,184,0.7);
      color: #374151;
    }

    button.ghost {
      background: #f9fafb;
      color: var(--text-muted);
      border: 2px dashed rgba(148,163,184,0.7);
    }

    button.danger {
      background: #fee2e2;
      color: #b91c1c;
      border: 2px solid rgba(248,113,113,0.9);
    }

    button.success {
      background: #dcfce7;
      color: #166534;
      border: 2px solid rgba(74,222,128,0.9);
    }

    button.wide {
      width: 100%;
      justify-content: center;
    }

    button:disabled {
      opacity: 0.45;
      cursor: default;
      transform: none !important;
      box-shadow: none !important;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
    }

    .reveal-panel {
      margin-top: 10px;
      padding: 10px 10px 8px;
      border-radius: 16px;
      border: 2px solid #fed7aa;
      background: #fffbeb;
      font-size: 0.9rem;
      display: none;
      flex-direction: column;
      gap: 6px;
    }

    .reveal-heading {
      font-weight: 700;
      color: #b45309;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .reveal-heading::before {
      content: "‚è∞";
    }

    .reveal-sub {
      font-size: 0.82rem;
      color: #92400e;
    }

    .answer-text {
      font-size: 1rem;
      font-weight: 700;
      color: #ea580c;
      margin-top: 4px;
    }

    .answer-meta {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .answer-actions {
      margin-top: 6px;
      display: flex;
      justify-content: flex-start;
      gap: 6px;
    }

    .note {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .side-panel-section {
      margin-bottom: 10px;
    }

    .side-panel-section h3 {
      margin: 0 0 4px;
      font-size: 0.9rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .instructions {
      font-size: 0.86rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .instructions ol {
      padding-left: 18px;
      margin: 3px 0 0;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.8rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: #e0f2fe;
      border: 2px solid rgba(59,130,246,0.9);
      color: #1d4ed8;
      font-weight: 600;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      font-size: 0.78rem;
      margin-top: 4px;
    }

    .tiny-pill {
      border-radius: 999px;
      padding: 3px 7px;
      background: #f3e8ff;
      border: 1px solid rgba(167,139,250,0.9);
      color: #6d28d9;
    }

    code {
      font-size: 0.78rem;
      background: #f9fafb;
      padding: 2px 4px;
      border-radius: 4px;
    }

    .card-side-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .rules-toggle-btn {
      padding: 4px 8px;
      font-size: 0.75rem;
      border-radius: 999px;
      background: #e0f2fe;
      border: 2px solid rgba(59,130,246,0.9);
      color: #1d4ed8;
      font-weight: 600;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    .rules-toggle-btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .card-side.collapsed {
      padding-bottom: 10px;
    }

    .card-side.collapsed .side-content {
      display: none;
    }

    /* Player overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .overlay-card {
      background: #fffaf3;
      border-radius: 24px;
      padding: 18px 20px 18px;
      border: 4px solid #f97316;
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
      width: min(420px, 90vw);
      max-height: 90vh;
      overflow: auto;
    }

    .overlay-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .overlay-title span.icon {
      font-size: 1.6rem;
    }

    .overlay-title h2 {
      margin: 0;
      font-size: 1.2rem;
    }

    .overlay-sub {
      font-size: 0.86rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .player-input-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .player-input-row label {
      font-size: 0.85rem;
      color: var(--text-muted);
      min-width: 52px;
    }

    .player-input-row input {
      flex: 1;
      border-radius: 999px;
      border: 2px solid rgba(148,163,184,0.7);
      padding: 6px 10px;
      font-size: 0.9rem;
      outline: none;
    }

    .player-input-row input:focus {
      border-color: #f97316;
      box-shadow: 0 0 0 2px rgba(248,177,88,0.6);
    }

    .overlay-actions {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .overlay-error {
      font-size: 0.8rem;
      color: #b91c1c;
      margin-top: 4px;
      min-height: 1em;
    }

    .overlay-note {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .overlay button.small {
      padding: 5px 10px;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <div class="table">
    <div class="table-title">
      <div class="table-title-icon">üëÉ</div>
      <div class="table-title-text">
        <div class="main">Scent Heads Up</div>
        <div class="sub">Tabletop Edition</div>
      </div>
    </div>

    <div class="score-card">
      <div class="score-chip">
        Rounds
        <span class="value" id="rounds-count">0</span>
      </div>
      <div class="score-chip correct">
        Correct
        <span class="value" id="correct-count">0</span>
      </div>
    </div>

    <div class="table-inner">
      <!-- Main game card -->
      <section class="card card-main" aria-label="Game Controls">
        <div class="card-header-label">Round</div>
        <h2>
          <span class="emoji">üé¥</span>
          Smell Pair
        </h2>

        <!-- Current players for this round -->
        <div class="player-round-card" id="player-round-card" style="display:none;">
          <div class="player-round-label">This round</div>
          <div class="player-round-names">
            <span id="player-a-name">Player A</span>
            <span>&amp;</span>
            <span id="player-b-name">Player B</span>
          </div>
        </div>

        <div>
          <div class="categories" id="category-buttons">
            <!-- category buttons populated by JS -->
          </div>

          <div class="status-line">
            <div class="dot" id="status-dot"></div>
            <span id="status-text">Select a category to start a round.</span>
          </div>

          <div class="round-info" id="round-info" style="display:none;">
            <div><strong id="round-category-label">Category: ‚Äì</strong></div>
            <div class="jar-row" id="jar-row">
              <!-- jar pills injected via JS -->
            </div>
            <div class="hint">
              Hand each jar to a different player. Don‚Äôt say the labels out loud ‚Äî only describe the smells.
            </div>
          </div>

          <div class="timer-block" aria-label="Round Timer">
            <div>
              <div class="timer-label">Countdown</div>
              <div class="timer-display" id="timer-display">02:00</div>
            </div>
            <div class="timer-controls">
              <button class="secondary" id="new-pair-btn" disabled>
                üé≤ New pair
              </button>
              <button class="ghost" id="reset-btn" disabled>
                üîÑ Reset
              </button>
              <button class="primary" id="start-btn" disabled>
                ‚ñ∂ Start 2 min
              </button>
            </div>
          </div>

          <div class="reveal-panel" id="reveal-panel">
            <div class="reveal-heading" id="reveal-heading">Time is up!</div>
            <div class="reveal-sub" id="reveal-sub">
              Talk it out and agree on your final guess. When you‚Äôre ready, press ‚ÄúReveal Answer‚Äù.
            </div>

            <button class="primary wide" id="reveal-answer-btn">
              üëÄ Reveal Answer
            </button>

            <div class="answer-text" id="answer-text" style="display:none;">Answer: ‚Äì</div>
            <div class="answer-meta" id="answer-meta" style="display:none;"></div>

            <div class="answer-actions" id="answer-actions" style="display:none;">
              <button class="success" id="correct-btn">‚úÖ We got it right</button>
              <button class="danger" id="incorrect-btn">‚ùå We missed it</button>
            </div>

            <div class="note">
              Scoring uses the honour system ‚Äî be fair to yourselves (and each other). üòâ
            </div>
          </div>
        </div>
      </section>

      <!-- Side rules card -->
      <aside class="card card-side" aria-label="How to Play" id="rules-card">
        <div class="card-side-header-row">
          <div class="card-header-label">Rules</div>
          <button class="rules-toggle-btn" id="rules-toggle-btn" type="button">
            Hide
          </button>
        </div>

        <div class="side-content" id="rules-content">
          <div class="side-panel-section">
            <h3>How to Play</h3>
            <div class="instructions">
              <ol>
                <li>Choose a <strong>category card</strong>.</li>
                <li>The table shows two <strong>jar numbers</strong>.</li>
                <li>Give each jar to a different player.</li>
                <li>Start the <strong>2 minute timer</strong>.</li>
                <li>Each player smells their jar and describes it. Together, guess what the two scents combine into.</li>
                <li>When time is up, stop, agree on your guess, then press <strong>Reveal Answer</strong> and mark your score.</li>
              </ol>
            </div>
          </div>

          <div class="side-panel-section">
            <h3>Table Setup</h3>
            <div class="badge">
              ‚è± 2 minute rounds
            </div>
            <div class="pill-row">
              <div class="tiny-pill">Shared screen</div>
              <div class="tiny-pill">Honour scoring</div>
              <div class="tiny-pill">Re-usable scents</div>
            </div>
            <div class="note">
              Edit scent pairs &amp; jar numbers in the <code>gameData</code> object in the script below.
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Player setup overlay -->
  <div class="overlay" id="player-overlay">
    <div class="overlay-card">
      <div class="overlay-title">
        <span class="icon">üßë‚Äçü§ù‚Äçüßë</span>
        <h2>Who‚Äôs playing?</h2>
      </div>
      <div class="overlay-sub">
        Add at least two players. Each round, two people will be randomly chosen to play.
      </div>

      <div id="player-inputs">
        <div class="player-input-row">
          <label>Player 1</label>
          <input type="text" class="player-input" placeholder="Name">
        </div>
        <div class="player-input-row">
          <label>Player 2</label>
          <input type="text" class="player-input" placeholder="Name">
        </div>
      </div>

      <div class="overlay-actions">
        <button class="secondary small" id="add-player-btn" type="button">
          ‚ûï Add player
        </button>
        <button class="primary small" id="start-game-btn" type="button">
          ‚ñ∂ Start game
        </button>
      </div>

      <div class="overlay-error" id="overlay-error"></div>
      <div class="overlay-note">
        You can add up to 10 players. Names can be changed later by reloading the page.
      </div>
    </div>
  </div>

  <script>
    // ----------------------------
    // Game data (EDIT THIS PART)
    // ----------------------------
    const gameData = {
      categories: [
        {
          id: 'locations',
          name: 'Places / Locations',
          description: 'Spaces you can stand in or move through.',
          pairs: [
            {
              id: 'campfire',
              answer: 'Campfire',
              jars: [1, 2],
              scentLabels: ['Smoke', 'Pine trees']
            },
            {
              id: 'farm',
              answer: 'Farm',
              jars: [3, 4],
              scentLabels: ['Hay', 'Manure']
            }
          ]
        },
        {
          id: 'food-drink',
          name: 'Food & Drinks',
          description: 'Edible things and beverages.',
          pairs: [
            {
              id: 'bakery',
              answer: 'Bakery',
              jars: [5, 6],
              scentLabels: ['Caramel', 'Vanilla']
            },
            {
              id: 'coffee-shop',
              answer: 'Coffee Shop',
              jars: [7, 8],
              scentLabels: ['Coffee', 'Sweet pastry']
            }
          ]
        },
        {
          id: 'things',
          name: 'Objects / Things',
          description: 'Everyday objects or scenes.',
          pairs: [
            {
              id: 'christmas-tree',
              answer: 'Christmas Tree',
              jars: [9, 10],
              scentLabels: ['Pine', 'Cinnamon / spices']
            },
            {
              id: 'beach-day',
              answer: 'Beach Day',
              jars: [11, 12],
              scentLabels: ['Salt water', 'Sunscreen / coconut']
            }
          ]
        }
      ],
      roundDurationSeconds: 120
    };

    // ----------------------------
    // State
    // ----------------------------
    let currentCategory = null;
    let currentPair = null;
    let timerSecondsRemaining = gameData.roundDurationSeconds;
    let timerIntervalId = null;
    let timerRunning = false;
    let timerFinished = false;
    let roundsPlayed = 0;
    let roundsCorrect = 0;

    let players = [];
    let currentRoundPlayers = [];

    // ----------------------------
    // DOM Elements
    // ----------------------------
    const categoryButtonsContainer = document.getElementById('category-buttons');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const roundInfo = document.getElementById('round-info');
    const roundCategoryLabel = document.getElementById('round-category-label');
    const jarRow = document.getElementById('jar-row');
    const timerDisplay = document.getElementById('timer-display');
    const newPairBtn = document.getElementById('new-pair-btn');
    const resetBtn = document.getElementById('reset-btn');
    const startBtn = document.getElementById('start-btn');
    const revealPanel = document.getElementById('reveal-panel');
    const revealHeading = document.getElementById('reveal-heading');
    const revealSub = document.getElementById('reveal-sub');
    const revealAnswerBtn = document.getElementById('reveal-answer-btn');
    const answerText = document.getElementById('answer-text');
    const answerMeta = document.getElementById('answer-meta');
    const answerActions = document.getElementById('answer-actions');
    const correctBtn = document.getElementById('correct-btn');
    const incorrectBtn = document.getElementById('incorrect-btn');
    const roundsCountLabel = document.getElementById('rounds-count');
    const correctCountLabel = document.getElementById('correct-count');

    const rulesCard = document.getElementById('rules-card');
    const rulesToggleBtn = document.getElementById('rules-toggle-btn');

    // Player round card
    const playerRoundCard = document.getElementById('player-round-card');
    const playerANameEl = document.getElementById('player-a-name');
    const playerBNameEl = document.getElementById('player-b-name');

    // Overlay elements
    const playerOverlay = document.getElementById('player-overlay');
    const playerInputsContainer = document.getElementById('player-inputs');
    const addPlayerBtn = document.getElementById('add-player-btn');
    const startGameBtn = document.getElementById('start-game-btn');
    const overlayError = document.getElementById('overlay-error');

    // ----------------------------
    // Helpers
    // ----------------------------
    function formatTime(seconds) {
      const m = Math.floor(seconds / 60).toString().padStart(2, '0');
      const s = (seconds % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function setTimer(seconds) {
      timerSecondsRemaining = seconds;
      timerDisplay.textContent = formatTime(timerSecondsRemaining);
    }

    function clearTimer() {
      if (timerIntervalId !== null) {
        clearInterval(timerIntervalId);
        timerIntervalId = null;
      }
      timerRunning = false;
    }

    function updateScoreboard() {
      roundsCountLabel.textContent = roundsPlayed;
      correctCountLabel.textContent = roundsCorrect;
    }

    function pickRandomPair(category) {
      const pairs = category.pairs;
      if (!pairs || pairs.length === 0) return null;
      const idx = Math.floor(Math.random() * pairs.length);
      return pairs[idx];
    }

    function updateStatus(text, live = false) {
      statusText.textContent = text;
      if (live) {
        statusDot.classList.add('live');
      } else {
        statusDot.classList.remove('live');
      }
    }

    function renderRoundInfo() {
      if (!currentCategory || !currentPair) {
        roundInfo.style.display = 'none';
        return;
      }
      roundInfo.style.display = 'flex';
      roundCategoryLabel.textContent = `Category: ${currentCategory.name}`;
      jarRow.innerHTML = '';
      currentPair.jars.forEach((jarNum, index) => {
        const pill = document.createElement('div');
        pill.className = 'jar-pill';
        const labelSpan = document.createElement('span');
        labelSpan.className = 'label';
        labelSpan.textContent = `Jar ${index + 1}`;
        const valueSpan = document.createElement('span');
        valueSpan.className = 'value';
        valueSpan.textContent = `#${jarNum}`;
        pill.appendChild(labelSpan);
        pill.appendChild(valueSpan);
        jarRow.appendChild(pill);
      });
    }

    function hideRevealPanel() {
      revealPanel.style.display = 'none';
      answerText.style.display = 'none';
      answerMeta.style.display = 'none';
      answerActions.style.display = 'none';
      revealAnswerBtn.style.display = 'inline-flex';
    }

    function resetRound(hardResetCategory = false) {
      clearTimer();
      setTimer(gameData.roundDurationSeconds);
      timerFinished = false;
      hideRevealPanel();

      if (hardResetCategory) {
        currentCategory = null;
        currentPair = null;
        roundInfo.style.display = 'none';
        const buttons = categoryButtonsContainer.querySelectorAll('.category-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        updateStatus('Select a category to start a round.', false);
        newPairBtn.disabled = true;
        resetBtn.disabled = true;
        startBtn.disabled = true;
        playerRoundCard.style.display = 'none';
      } else {
        currentPair = null;
        roundInfo.style.display = 'none';
        if (currentCategory) {
          updateStatus('Press ‚ÄúNew pair‚Äù to pick another combination in this category.', false);
          newPairBtn.disabled = false;
          resetBtn.disabled = false;
          startBtn.disabled = true;
        }
      }
    }

    function startTimer() {
      if (!currentPair || !currentCategory) return;
      if (timerRunning) return;

      timerRunning = true;
      timerFinished = false;
      hideRevealPanel();
      updateStatus('Timer running ‚Äî describe your scents and guess together!', true);

      newPairBtn.disabled = true;
      resetBtn.disabled = false;
      startBtn.disabled = true;

      timerIntervalId = setInterval(() => {
        timerSecondsRemaining--;
        timerDisplay.textContent = formatTime(timerSecondsRemaining);

        if (timerSecondsRemaining <= 0) {
          clearTimer();
          timerFinished = true;
          timerSecondsRemaining = 0;
          timerDisplay.textContent = formatTime(0);
          updateStatus('Time is up! Stop smelling and lock in your guess, then reveal the answer.', false);
          showRevealPrompt();
        }
      }, 1000);
    }

    function showRevealPrompt() {
      if (!currentPair || !currentCategory) return;
      revealPanel.style.display = 'flex';
      revealHeading.textContent = 'Time is up!';
      revealSub.textContent = 'Talk it out and agree on your final guess. When you‚Äôre ready, press ‚ÄúReveal Answer‚Äù.';
      answerText.style.display = 'none';
      answerMeta.style.display = 'none';
      answerActions.style.display = 'none';
      revealAnswerBtn.style.display = 'inline-flex';
    }

    function revealAnswer() {
      if (!currentPair || !currentCategory) return;

      answerText.textContent = `Answer: ${currentPair.answer}`;

      const labels = currentPair.scentLabels && currentPair.scentLabels.length
        ? currentPair.scentLabels.map((label, i) =>
            `Jar ${i + 1} (#${currentPair.jars[i]}): ${label}`
          ).join(' ‚Ä¢ ')
        : `Jars: ${currentPair.jars.map((n, i) => `Jar ${i + 1} #${n}`).join(' ‚Ä¢ ')}`;

      answerMeta.textContent = labels;

      revealHeading.textContent = 'Answer revealed';
      revealSub.textContent = 'Now mark whether your guess was correct or not.';

      answerText.style.display = 'block';
      answerMeta.style.display = 'block';
      answerActions.style.display = 'flex';
      revealAnswerBtn.style.display = 'none';
    }

    // Pick two distinct players for this round
    function pickPlayersForRound() {
      if (!players || players.length < 2) {
        currentRoundPlayers = [];
        playerRoundCard.style.display = 'none';
        return;
      }
      if (players.length === 2) {
        currentRoundPlayers = [players[0], players[1]];
      } else {
        const idx1 = Math.floor(Math.random() * players.length);
        let idx2 = Math.floor(Math.random() * players.length);
        while (idx2 === idx1) {
          idx2 = Math.floor(Math.random() * players.length);
        }
        currentRoundPlayers = [players[idx1], players[idx2]];
      }
      playerANameEl.textContent = currentRoundPlayers[0];
      playerBNameEl.textContent = currentRoundPlayers[1];
      playerRoundCard.style.display = 'flex';
    }

    // ----------------------------
    // Event handlers
    // ----------------------------
    function handleCategoryClick(categoryId) {
      if (players.length < 2) {
        alert('Please add at least two players before starting.');
        return;
      }

      const cat = gameData.categories.find(c => c.id === categoryId);
      if (!cat) return;

      const buttons = categoryButtonsContainer.querySelectorAll('.category-btn');
      buttons.forEach(btn => {
        if (btn.dataset.categoryId === categoryId) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });

      currentCategory = cat;
      currentPair = pickRandomPair(cat);
      pickPlayersForRound();
      setTimer(gameData.roundDurationSeconds);
      timerFinished = false;
      hideRevealPanel();
      clearTimer();

      renderRoundInfo();
      newPairBtn.disabled = false;
      resetBtn.disabled = false;
      startBtn.disabled = false;

      updateStatus(`Playing in ‚Äú${cat.name}‚Äù. Hand out the jars to ${currentRoundPlayers[0]} and ${currentRoundPlayers[1]}, then start the timer.`, false);
    }

    newPairBtn.addEventListener('click', () => {
      if (!currentCategory) return;
      clearTimer();
      setTimer(gameData.roundDurationSeconds);
      timerFinished = false;
      hideRevealPanel();

      currentPair = pickRandomPair(currentCategory);
      pickPlayersForRound();
      renderRoundInfo();
      newPairBtn.disabled = false;
      resetBtn.disabled = false;
      startBtn.disabled = false;

      updateStatus(`New pair selected. Jars go to ${currentRoundPlayers[0]} and ${currentRoundPlayers[1]}. Hand them out, then start the timer.`, false);
    });

    resetBtn.addEventListener('click', () => {
      resetRound(true);
    });

    startBtn.addEventListener('click', () => {
      if (!currentPair || !currentCategory) return;
      startTimer();
    });

    revealAnswerBtn.addEventListener('click', () => {
      revealAnswer();
    });

    correctBtn.addEventListener('click', () => {
      roundsPlayed++;
      roundsCorrect++;
      updateScoreboard();
      updateStatus('Nice! Marked as correct. Choose another pair or switch category.', false);
      resetRound(false);
    });

    incorrectBtn.addEventListener('click', () => {
      roundsPlayed++;
      updateScoreboard();
      updateStatus('Marked as incorrect. Try another pair or switch category.', false);
      resetRound(false);
    });

    // Rules card toggle
    rulesToggleBtn.addEventListener('click', () => {
      const isCollapsed = rulesCard.classList.toggle('collapsed');
      if (isCollapsed) {
        rulesToggleBtn.textContent = 'Show';
      } else {
        rulesToggleBtn.textContent = 'Hide';
      }
    });

    // Player overlay logic
    function getPlayerInputs() {
      return Array.from(document.querySelectorAll('.player-input'));
    }

    function collectPlayers() {
      const inputs = getPlayerInputs();
      const names = inputs
        .map(input => input.value.trim())
        .filter(name => name.length > 0);
      return names;
    }

    addPlayerBtn.addEventListener('click', () => {
      const currentCount = getPlayerInputs().length;
      if (currentCount >= 10) {
        overlayError.textContent = 'You can‚Äôt add more than 10 players.';
        return;
      }
      overlayError.textContent = '';
      const row = document.createElement('div');
      row.className = 'player-input-row';
      const label = document.createElement('label');
      label.textContent = `Player ${currentCount + 1}`;
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'player-input';
      input.placeholder = 'Name';
      row.appendChild(label);
      row.appendChild(input);
      playerInputsContainer.appendChild(row);
    });

    startGameBtn.addEventListener('click', () => {
      const names = collectPlayers();
      if (names.length < 2) {
        overlayError.textContent = 'Please enter at least two player names.';
        return;
      }
      players = names;
      overlayError.textContent = '';
      playerOverlay.style.display = 'none';
      updateStatus('Select a category to start a round.', false);
    });

    // ----------------------------
    // Initial render
    // ----------------------------
    function initCategories() {
      gameData.categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.dataset.categoryId = cat.id;

        const labelSpan = document.createElement('span');
        labelSpan.className = 'label';
        labelSpan.textContent = cat.name;

        const pillSpan = document.createElement('span');
        pillSpan.className = 'pill';
        pillSpan.textContent = `${cat.pairs.length} pairs`;

        btn.appendChild(labelSpan);
        btn.appendChild(pillSpan);

        btn.addEventListener('click', () => handleCategoryClick(cat.id));
        categoryButtonsContainer.appendChild(btn);
      });
    }

    function init() {
      initCategories();
      setTimer(gameData.roundDurationSeconds);
      updateStatus('Add players to begin.', false);
      newPairBtn.disabled = true;
      resetBtn.disabled = true;
      startBtn.disabled = true;
      hideRevealPanel();
      updateScoreboard();
    }

    init();
  </script>
</body>
</html>
